#!/bin/bash
echo "
################################################################################
#
#   Green Client VM :: User Data Action
#
################################################################################
"

# ToDo List
# 근본적으로는 3, 4, 5번이 리부팅이 되어도 실행되게 해야함.
# 그리고 vm을 생성할때 IP를 고정시켜야 함. 그래야 5번이 확실함.

echo "
# ---------------------------------------------------
# 1. install iperf
# ---------------------------------------------------
"

apt-get -y update  
apt-get -y install iperf

echo "
# --------------------------------------------------- 
# 2. green nic activate & attach IP
# ---------------------------------------------------
"
# green nic 
# ifconfig eth1 192.168.0.101 netmask 255.255.255.0 up
ifconfig eth1 192.168.0.46 netmask 255.255.255.0 up

echo "
# --------------------------------------------------- 
# 3. iperf -c 실행
# ---------------------------------------------------
"

# orange server 가 준비될때까지 기다린다(5분이면 충분하지 않을까?)
# LJG: 성능 측정 및 수집방법
#   - global_mgmt_net에 연결된 하나의 vm에서 
#     모든 VM에게 원격으로 명령을 내리고 수집하는 구조가 더 효율적임 

#sleep 300
#/usr/bin/iperf -c  -i 5 -t 50 -P 5 > iperf.txt &
 
        
                        
echo "
################################################################################
#
#   End User Data Action
#
################################################################################
"


#!/bin/bash

file_name=$1
_nic=$2
_ip=$3
_netmask=$4

cat > $file_name <<EOF
#!/bin/bash

echo "
################################################################################
#
#   Orange Server VM :: User Data Action
#
################################################################################
"

echo "
# ---------------------------------------------------
# 1. install iperf
# ---------------------------------------------------
"

apt-get -y update  
apt-get -y install iperf

echo "
# --------------------------------------------------- 
# 2. orange nic activate & attach IP
# ---------------------------------------------------
"
# orange nic 
# ifconfig eth1 192.168.0.201 netmask 255.255.255.0 up
ifconfig $_nic $_ip netmask $_netmask up

echo "
# --------------------------------------------------- 
# 3. iperf -s 실행
# ---------------------------------------------------
"
# nohup python /usr/local/bin/VmServicePortCheck.py > /dev/null 2>&1 &
nohup /usr/bin/iperf -s > /dev/null &2>1 & 
               
echo "
################################################################################
#
#   End User Data Action
#
################################################################################
"

EOF